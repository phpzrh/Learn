{extend name="index@index/base" /}
{block name="main"}

<div class="breadcrumbs" id="breadcrumbs">
    <script type="text/javascript">
        try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
    </script>

    <ul class="breadcrumb">
        <li>
            <i class="icon-home home-icon"></i>
            <a href="#">首页</a>
        </li>

        <li>
            <a href="#">获取料号资料首页</a>
        </li>
    </ul><!-- .breadcrumb -->
</div>

<div class="page-content">
    <div class="page-header col-xs-12">
        <h1 class="col-xs-4">
            获取料号资料
        </h1>
        <a  href="{:url('cost/cost_part/agent')}" target="_blank" title="外包厂资料维护" class="btn btn-primary pull-right">维护外包厂资料</a>

        <button class="btn btn-primary pull-right get_bom" style="margin:0 15px 0 0;">获取最新BOM数据</button>

    </div><!-- /.page-header -->

    <div class="row"><!-- /.col -->
        <div>
          <form method="get">
              <label style="margin-left: 12px;height: 30px;font-size: 16px;">输入料号:</label>
                 <input type="text" name="agent" style="height: 30px;margin-left:12px;width: 200px;" value="{$page_info.agent?$page_info.agent:'';}">
                 <button class="btn btn-primary" style="margin-left: 50px;">搜索</button>
          </form>
        </div>
        <div>
            <table class="table table-hover" style="margin-left: 12px;margin-top:10px; ">
                <thead>
                <tr>
                    <th>id:</th>
                    <th>料号：</th>
                    <th>外包厂：</th>
                    <th>价格</th>
                    <th>母体：</th>
                    <th>阶段：</th>
                </tr>
                </thead>
                <tbody>
               {volist name="$page_info.data" id="vo"}
                    <tr  style="cursor: pointer">
                        <td>{$vo.id}</td>
                        <td>{$vo.partno}</td>
                        <td>{$vo.agent_id_str}</td>
                        <td>{$vo.price}</td>
                        <td>{$vo.mother}</td>
                        <td style="color: red">{$vo.part_level}</td>
                    </tr>
                {/volist}
                </tbody>
            </table>
            {$page_info.page}

        </div>
    </div><!-- /.row -->
</div>
{/block}

{block name="script"}
<script type="text/javascript">
    //获取最新bom数据
    $(".get_bom").click(function(){
        $.ajax({
            type: 'POST',
            url: "{:url('cost/cost_part/get_bom')}",
            beforeSend: function(){
                this.layerIndex = layer.load(1, {
                    shade: 0.3 //0.1透明度的白色背景
                });
            },
            dataType:"json",
            success:function(result){
                layer.close(this.layerIndex);
                showMsg(result);
            }
        });
    });



    showStatus_a_button('{$Think.PRI_ARR}','{$Think.RBAC_FLAG}');
</script>
{/block}
